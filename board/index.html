<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>EYEK • Board</title>
<style>
  body{margin:0; font-family:system-ui, Arial, sans-serif; background:#060a12; color:#e8f0ff}
  .wrap{max-width:900px; margin:30px auto; padding:0 16px}
  h1{margin:0 0 12px}
  .muted{color:#95a6c1}
  .row{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid #111827}
  .name{font-weight:800}
  .dots{display:flex; gap:8px}
  .dot{width:10px;height:10px;border-radius:50%}
  .green{background:#22c55e}.yellow{background:#facc15}.red{background:#ef4444}
</style>
</head>
<body>
<div class="wrap">
  <h1>Rotation</h1>
  <div class="muted" id="hdr">—</div>
  <div id="list"></div>
</div>
<script>
const API='/assets/api.php';
function row(name, tally, isCurrent){
  const div=document.createElement('div'); div.className='row';
  div.innerHTML=`
    <div class="name">${isCurrent?'▶ ':''}${name}</div>
    <div class="dots" title="Encore / Another / Maybe">
      <span class="dot green"  style="opacity:${tally.encore?1:.25}"></span>
      <span class="dot yellow" style="opacity:${tally.another?1:.25}"></span>
      <span class="dot red"    style="opacity:${tally.maybe?1:.25}"></span>
    </div>`;
  return div;
}
async function refresh(){
  const r = await fetch(API+'?cmd=get&ts='+Date.now(),{cache:'no-store'}); const j=await r.json();
  if(!j.ok) return;
  const st=j.state;
  document.getElementById('hdr').textContent = `${st.event.venue||''} • ${st.event.kj||''}`;
  const list=document.getElementById('list'); list.innerHTML='';
  st.singers.forEach(s=>{
    list.appendChild(row(s.name, s.tally, st.currentSingerId===s.id));
  });
}
refresh();
setInterval(refresh, 3000);
</script>
</body>
</html>
