<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EYEK • Board</title>
<style>
  :root{--bg:#060c1a;--ink:#e9f1ff;--sub:#a6b8dc;--green:#33e27b;--yellow:#ffd166;--red:#ff6b6b;}
  html,body{margin:0;height:100%;background:linear-gradient(180deg,#0e1a36,#060c1a);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{padding:28px;max-width:1100px;margin:0 auto}
  h1{margin:0 0 10px;font-size:42px}
  h2{margin:18px 0 8px;font-size:22px;color:var(--sub)}
  .pill{display:inline-block;padding:4px 10px;border-radius:999px;background:#13224a;color:#bed0ff;font-size:12px;margin-left:8px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
  .card{background:#0f1930;border-radius:14px;padding:16px;box-shadow:0 8px 24px rgba(0,0,0,.25)}
  ul{margin:8px 0 0 18px;line-height:1.8}
  .res{font-weight:800}
  .enc{color:var(--green)} .ano{color:#f6c04d} .may{color:#ff8484}
</style>
</head>
<body>
<div class="wrap">
  <h1>Earn Your Encore Karaoke <span id="vInfo" class="pill"></span></h1>
  <div class="grid">
    <div class="card">
      <h2>Up Now</h2>
      <div id="now">—</div>
      <div id="song" style="color:var(--sub)"></div>
    </div>
    <div class="card">
      <h2>Last Result</h2>
      <div id="last">—</div>
    </div>
  </div>
  <div class="card" style="margin-top:18px">
    <h2>Queue</h2>
    <ul id="queue"></ul>
  </div>
</div>

<script>
const API='/assets/state.php';
function apiGet(){const u=new URL(API,location.origin);u.searchParams.set('action','get');return fetch(u,{cache:'no-store'}).then(r=>r.json())}
function render(s){
  const ev=s.event||{venue:'',kj:''};
  document.getElementById('vInfo').textContent = ev.venue ? `${ev.venue} • KJ ${ev.kj||''}` : (ev.kj?`KJ ${ev.kj}`:'');
  const cur=s.current||{name:'',song:''};
  document.getElementById('now').textContent = cur.name||'—';
  document.getElementById('song').textContent= cur.song||'';

  const q=document.getElementById('queue'); q.innerHTML='';
  (s.queue||[]).forEach(x=>{ const li=document.createElement('li'); li.textContent=x.name; q.appendChild(li); });

  const last=s.lastResult;
  const lastEl=document.getElementById('last');
  if (!last) lastEl.textContent='—';
  else {
    lastEl.innerHTML = last==='encore' ? '<span class="res enc">Encore!</span>' :
                       last==='another'? '<span class="res ano">Another Shot!</span>' :
                                         '<span class="res may">Maybe Next Time</span>';
  }
}
setInterval(async ()=>{ const r=await apiGet(); if(r.ok) render(r.state); }, 1500);
(async ()=>{ const r=await apiGet(); if(r.ok) render(r.state); })();
</script>
</body>
</html>
