<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Encore Karaoke â€” Screen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-store" />
  <!-- Styles omitted for brevity -->
</head>
<body>
  <!-- Body omitted for brevity -->

  <script>
    (function(){
      // Existing Firebase setup and variables...

      function watchPerformance(perfId){
        // FIX: always reset subscriptions, even if perfId matches
        if(unsubPerf){ unsubPerf(); unsubPerf=null; }
        if(unsubVotes){ unsubVotes(); unsubVotes=null; }
        CURRENT.performanceId = perfId;
        COUNTS.encore=COUNTS.another=COUNTS.maybe=0; PREV.encore=PREV.another=PREV.maybe=0; prevLeader=null;
        renderBars();
        if(!perfId){
          setBadge('pending'); stopCountdown(); setQrForUrl(null); hideFlashBanner(); stopVoteLoop(); hideEncoreOverlay(true); clearPostCloseTimer(); return;
        }
        updateQr();
        // ... rest of original watchPerformance logic ...
      }

      // ... rest of the original script ...
    })();
  </script>
</body>
</html>