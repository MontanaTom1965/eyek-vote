<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>EYEK • Screen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    html,body{height:100%;margin:0;background:#06080f;color:#e6eef8;font-family:system-ui,Segoe UI,Arial,sans-serif;overflow:hidden}
    .wrap{display:grid;grid-template-rows:auto 1fr auto;height:100%}
    header{display:flex;justify-content:space-between;align-items:center;padding:18px 24px;background:#0b1020;border-bottom:1px solid #151c2e}
    .big{font-size:72px;font-weight:800;text-align:center;margin:40px 20px}
    .mid{font-size:28px;text-align:center;opacity:.9}
    footer{padding:12px 18px;text-align:center;color:#9fb0cf}
    .pulse{animation:pulse 2s infinite}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.75}}
    .confetti{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div id="venue">Venue</div>
    <div id="kj">KJ</div>
  </header>
  <main>
    <div id="headline" class="big pulse">Welcome!</div>
    <div id="sub" class="mid">Get ready to vote</div>
    <canvas id="confetti" class="confetti"></canvas>
    <audio id="sfxWin" src="/assets/you_win_001.mp3" preload="auto"></audio>
    <audio id="sfxShot" src="/assets/quiz-countdown.mp3" preload="auto"></audio>
    <audio id="sfxLose" src="/assets/sad_horn.mp3" preload="auto"></audio>
  </main>
  <footer>Earn Your Encore Karaoke</footer>
</div>
<script>
const URL='/assets/status.json';
let lastStatus='', rafId=0;

const elVenue = document.getElementById('venue');
const elKJ = document.getElementById('kj');
const elHead = document.getElementById('headline');
const elSub = document.getElementById('sub');

const sfxWin  = document.getElementById('sfxWin');
const sfxShot = document.getElementById('sfxShot');
const sfxLose = document.getElementById('sfxLose');

async function load(){
  const r = await fetch(URL+'?_=' + Date.now());
  const j = await r.json();
  elVenue.textContent = j.event.venue || 'Venue';
  elKJ.textContent = 'KJ: ' + (j.event.kj||'');
  const cur = j.current||{};
  const state = cur.status||'idle';

  if (state==='voting'){
    elHead.textContent = (cur.singer? cur.singer : 'Get Ready') + (cur.songArtist ? ' — ' + cur.songArtist : '');
    elSub.textContent = 'Voting in progress…';
  } else if (state==='Encore'){
    elHead.textContent = 'ENCORE!';
    elSub.textContent = (cur.singer||'') + ' got the Encore!';
    playWin();
  } else if (state==='Another Shot'){
    elHead.textContent = 'Another Shot!';
    elSub.textContent = (cur.singer||'') + ' gets another chance!';
    playShot();
  } else if (state==='Maybe Next Time'){
    elHead.textContent = 'Maybe Next Time…';
    elSub.textContent = (cur.singer||'') + ' will be back!';
    playLose();
  } else if (state==='waiting' && cur.singer){
    elHead.textContent = cur.singer + (cur.songArtist ? ' — ' + cur.songArtist : '');
    elSub.textContent = 'Get ready to vote…';
  } else {
    elHead.textContent = 'Welcome!';
    elSub.textContent = 'Get ready to vote';
  }

  // tiny drift to avoid TV sleep
  document.body.style.transform = `translateY(${Math.sin(Date.now()/20000)*2}px)`;

  lastStatus = state;
}

function playWin(){ if (lastStatus!=='Encore'){ boom(); sfxWin.currentTime=0; sfxWin.play().catch(()=>{});} }
function playShot(){ if (lastStatus!=='Another Shot'){ sfxShot.currentTime=0; sfxShot.play().catch(()=>{});} }
function playLose(){ if (lastStatus!=='Maybe Next Time'){ sfxLose.currentTime=0; sfxLose.play().catch(()=>{});} }

// simple confetti
function boom(){
  const c = document.getElementById('confetti');
  const ctx = c.getContext('2d');
  c.width = innerWidth; c.height= innerHeight;
  let parts = Array.from({length:160},()=>({
    x: Math.random()*c.width, y: -20 - Math.random()*200, vy: 2+Math.random()*4, vx: -2+Math.random()*4, s: 2+Math.random()*4
  }));
  cancelAnimationFrame(rafId);
  (function frame(){
    ctx.clearRect(0,0,c.width,c.height);
    parts.forEach(p=>{
      ctx.fillStyle = ['#1dd05d','#f9d64a','#5bc0ff','#ff5d7a'][p.s%4|0];
      ctx.fillRect(p.x,p.y,p.s,p.s*0.6);
      p.x += p.vx; p.y += p.vy; p.vy *= 0.99;
    });
    rafId = requestAnimationFrame(frame);
    setTimeout(()=>cancelAnimationFrame(rafId), 2000);
  })();
}

setInterval(load, 2000);
load();
</script>
</body>
</html>
