<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Screen | Earn Your Encore Karaoke</title>
  <style>
    body { margin:0; background:#0e0d2b; color:#fff; font-family:system-ui, sans-serif; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 28px; }
    header { text-align:center; margin-bottom: 20px; }
    h1 { margin: 0 0 8px; color: #ffd24a; font-size: clamp(22px, 3.5vw, 40px); }
    p.sub { margin: 0; color: #c9fffa; font-size: clamp(14px, 2.2vw, 18px); opacity: 0.95; }
    .screen { display:grid; grid-template-columns: 320px 1fr; gap: 24px; align-items: center; }
    .panel { background: #1e1d3a; border-radius: 14px; padding: 16px; }
    .qr { display:flex; flex-direction:column; align-items:center; justify-content:center; gap:10px; }
    .qr img { width: 100%; max-width: 280px; height:auto; border-radius: 10px; background:#fff; padding:10px; }
    .link { font-size: 14px; word-break: break-all; color:#ddd; text-align:center; }
    .bar { background:#141335; border-radius:10px; padding:10px; margin:10px 0 16px; }
    .bar label { display:block; font-weight:600; margin-bottom:6px; }
    .track { width:100%; background:#0f0e2a; border-radius:8px; height:22px; overflow:hidden; }
    .fill { height:22px; width:0%; transition: width 400ms ease; }
    .fill.ok { background: #27ae60; }
    .fill.maybe { background: #f39c12; }
    .fill.no { background: #c0392b; }
    .pct { font-size:13px; opacity:0.9; margin-top:6px; }
    footer { margin-top: 10px; text-align:center; font-size:12px; color:#9ec8c8; opacity:0.9; }
    @media (max-width: 860px) { .screen { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Did this singer earn an Encore?</h1>
      <p class="sub">Scan the code to vote: üî• Encore ¬∑ ü§î One More Shot ¬∑ ‚ùå Maybe Next Time</p>
    </header>

    <div class="screen">
      <!-- QR -->
      <div class="panel qr">
        <img id="qr" alt="QR code to vote" />
        <div class="link" id="voteLink"></div>
      </div>

      <!-- Live bars -->
      <div class="panel">
        <div class="bar">
          <label>üî• Encore</label>
          <div class="track"><div class="fill ok" id="barEncore"></div></div>
          <div class="pct" id="pctEncore">0 votes</div>
        </div>
        <div class="bar">
          <label>ü§î One More Shot</label>
          <div class="track"><div class="fill maybe" id="barOneMore"></div></div>
          <div class="pct" id="pctOneMore">0 votes</div>
        </div>
        <div class="bar">
          <label>‚ùå Maybe Next Time</label>
          <div class="track"><div class="fill no" id="barNextTime"></div></div>
          <div class="pct" id="pctNextTime">0 votes</div>
        </div>
      </div>
    </div>

    <footer>Earn Your Encore Karaoke ‚Äî An Interactive Upgrade for Karaoke Night!</footer>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>

  <script>
    // üîπ Replace with your actual Firebase config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Params
    const params = new URLSearchParams(location.search);
    const sid    = params.get('sid')    || 'TEST';
    const singer = params.get('singer') || 'this singer';

    // Update header with singer name
    document.querySelector('h1').textContent = `Did ${singer} earn an Encore?`;

    // Build vote link + QR
    const BASE = 'https://vote.earnyourencorekaraoke.com';
    const voteURL = `${BASE}/vote/?sid=${encodeURIComponent(sid)}&singer=${encodeURIComponent(singer)}`;
    document.getElementById('voteLink').textContent = voteURL;
    document.getElementById('qr').src = `https://chart.googleapis.com/chart?cht=qr&chs=280x280&chl=${encodeURIComponent(voteURL)}`;

    // Live vote counts
    let encore=0, one=0, nextt=0;
    function render() {
      const total = encore + one + nextt || 1;
      document.getElementById('barEncore').style.width   = (encore/total*100)+'%';
      document.getElementById('barOneMore').style.width  = (one/total*100)+'%';
      document.getElementById('barNextTime').style.width = (nextt/total*100)+'%';
      document.getElementById('pctEncore').textContent   = `${encore} vote${encore===1?'':'s'}`;
      document.getElementById('pctOneMore').textContent  = `${one} vote${one===1?'':'s'}`;
      document.getElementById('pctNextTime').textContent = `${nextt} vote${nextt===1?'':'s'}`;
    }

    // Listen to votes in Firestore
    db.collection('votes')
      .where('sid','==',sid)
      .onSnapshot(snap => {
        encore = one = nextt = 0;
        snap.forEach(doc => {
          const v = doc.data().choice;
          if (v === 'encore')    encore++;
          if (v === 'one_more')  one++;
          if (v === 'next_time') nextt++;
        });
        render();
      });
  </script>
  <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyDGbC08WxruYIDPhZSlDlU-7Kzq-7mHENk",
    authDomain: "eyek-vote.firebaseapp.com",
    projectId: "eyek-vote",
    storageBucket: "eyek-vote.firebasestorage.app",
    messagingSenderId: "954696683994",
    appId: "1:954696683994:web:21a84298a94648ff0230e3"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"
        integrity="sha512-Mi1LQj4h3+XrYh9wB0xqf0gYv3mRr0H8l3oK2cMZ8nJ1u2XGx3u2Yx0kX8sx1q6m4yXxvC2rQqk8b2r1N5z4YQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</body>
</html>

