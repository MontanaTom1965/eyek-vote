<!doctype html>
<meta charset="utf-8"><title>Encore! • Screen</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body{margin:0;background:#0f1526;color:#eaf2ff;font:20px system-ui}
  .wrap{display:grid;place-items:center;min-height:100svh;text-align:center;padding:4vmin}
  .title{font-size:6vmin;margin:0 0 2vmin}
  .venue{font-size:3vmin;color:#9db3ff;margin:0 0 4vmin}
  .now{font-size:4vmin;margin:0}
  .song{font-size:3vmin;color:#b9c6ff;margin:1vmin 0 5vmin}
  .row{display:flex;gap:2vmin;justify-content:center}
  .chip{padding:1vmin 2vmin;border-radius:12px;border:1px solid #2b3c62;background:#0d1428}
  .enc{color:#25d366}.ano{color:#f6c945}.may{color:#ff5e6c}
  .timer{font-size:8vmin;font-weight:800;margin:2vmin 0}
  .badge{display:inline-block;padding:.5vmin 1.5vmin;border:1px solid #2b3c62;border-radius:999px;background:#0d1428}
</style>
<div class="wrap">
  <h1 class="title">Encore! Voting</h1>
  <div id="venue" class="venue">—</div>
  <div class="now">Now Singing: <b id="who">—</b></div>
  <div id="song" class="song">—</div>
  <div id="timer" class="timer">00:00</div>
  <div class="row">
    <div class="chip enc">Encore: <b id="cE">0</b></div>
    <div class="chip ano">Another Shot: <b id="cA">0</b></div>
    <div class="chip may">Maybe Next Time: <b id="cM">0</b></div>
  </div>
  <div style="margin-top:3vmin"><span id="status" class="badge">Waiting…</span></div>
</div>
<script>
const GET_URL='/assets/get_state.php';
const $=s=>document.querySelector(s);
function fmt(ms){ const s=Math.ceil(ms/1000); const m=Math.floor(s/60), r=s%60; return `${String(m).padStart(2,'0')}:${String(r).padStart(2,'0')}` }
let state=null;
async function tick(){
  const r=await fetch(GET_URL,{cache:'no-store'}); state=await r.json();
  $('#venue').textContent = state.event?.venuePublic || state.event?.venue || '—';
  $('#who').textContent   = state.current?.name || '—';
  $('#song').textContent  = state.current?.songArtist || '—';
  const open = !!state.voting?.open;
  $('#cE').textContent = state.voting?.counts?.encore  ?? 0;
  $('#cA').textContent = state.voting?.counts?.another ?? 0;
  $('#cM').textContent = state.voting?.counts?.maybe   ?? 0;
  $('#status').textContent = open ? 'Voting OPEN' :
    (state.voting?.lastResult ? (state.voting.lastResult==='encore'?'Winner: Encore!':state.voting.lastResult==='another'?'Winner: Another Shot!':'Winner: Maybe Next Time') : 'Waiting…');
  if(open){ const ms=Math.max(0,(state.voting.endsAt||0)-Date.now()); $('#timer').textContent=fmt(ms); } else { $('#timer').textContent='00:00'; }
}
setInterval(tick, 800); tick();
</script>
