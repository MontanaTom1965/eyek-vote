<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>EYEK — Host Console</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0f1222; --panel:#171b34; --muted:#9aa3b2; --text:#eef2ff; --accent:#60a5fa; --danger:#fb7185; --ok:#34d399;
      --card:#12162b; --border:#262b4a;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;padding:14px 20px;border-bottom:1px solid var(--border);background:linear-gradient(0deg,transparent,rgba(255,255,255,0.02))}
    .grid{display:grid;grid-template-columns:320px 1fr 380px;gap:16px;padding:16px;min-height:calc(100vh - 62px)}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;overflow:hidden;display:flex;flex-direction:column}
    .panel h2{margin:0;padding:12px 14px;border-bottom:1px solid var(--border);font-size:16px;color:var(--muted);letter-spacing:.3px}
    .content{padding:12px 14px;display:flex;flex-direction:column;gap:10px}
    input,button,select,textarea{border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--text);padding:10px 12px;font-size:14px}
    input[readonly]{opacity:.7}
    button{cursor:pointer}
    .row{display:flex;gap:10px}
    .row > *{flex:1}
    .pill{display:inline-flex;align-items:center;gap:8px;background:#101429;border:1px solid var(--border);padding:6px 10px;border-radius:999px;font-size:12px;color:var(--muted)}
    .list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:8px;overflow:auto}
    .item{display:flex;gap:10px;align-items:flex-start;justify-content:space-between;padding:10px;border:1px solid var(--border);background:var(--card);border-radius:12px}
    .item .meta{font-size:12px;color:var(--muted)}
    .actions{display:flex;gap:8px}
    .actions button{padding:6px 10px;font-size:12px}
    .muted{color:var(--muted)}
    .ok{border-color:#194235;background:#0f2f24}
    .danger{border-color:#51202a;background:#2a1116}
    .section{display:flex;flex-direction:column;gap:8px}
    .split{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .small{font-size:12px}
    .tag{display:inline-block;background:#0f2036;color:#a8c8ff;border:1px solid #1f3a64;padding:3px 8px;border-radius:999px;font-size:12px}
    .flex{display:flex;gap:10px;align-items:center}
    .grow{flex:1}
    .right{text-align:right}
    .switch{display:inline-flex;align-items:center;gap:8px;cursor:pointer}
    .switch input{display:none}
    .switch span{width:38px;height:22px;background:#1a2242;border:1px solid var(--border);display:inline-block;border-radius:999px;position:relative;transition:.2s}
    .switch span:after{content:'';position:absolute;top:2px;left:2px;width:18px;height:18px;background:#fff;border-radius:50%;transition:.2s}
    .switch input:checked + span{background:#17351f;border-color:#2e6b3d}
    .switch input:checked + span:after{left:18px}
    .help{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>

<header>
  <div class="flex grow">
    <div class="pill">EYEK Host Console</div>
  </div>
  <div class="flex">
    <label class="switch small">
      <input id="lockToggle" type="checkbox">
      <span></span>
    </label>
    <div class="help">Lock KJ / Venue / PIN</div>
  </div>
</header>

<main class="grid">
  <!-- LEFT: SINGER LIST -->
  <section class="panel">
    <h2>Singer Queue</h2>
    <div class="content section">
      <ul id="queue" class="list"></ul>
      <div class="help">Tip: drag to reorder coming soon; for now use ↑/↓ buttons.</div>
    </div>
  </section>

  <!-- CENTER: KJ & ENTRY -->
  <section class="panel">
    <h2>KJ & Entry</h2>
    <div class="content section">
      <div class="split">
        <div class="section">
          <label class="small muted">Venue Name</label>
          <input id="venue" placeholder="e.g., The Blue Note" />
        </div>
        <div class="section">
          <label class="small muted">KJ Name (shows Tonight’s PIN)</label>
          <input id="kj" placeholder="e.g., Tom — PIN 1234" />
        </div>
      </div>

      <div class="row">
        <div class="section grow">
          <label class="small muted">Tonight’s PIN</label>
          <input id="pin" placeholder="e.g., 1234" />
        </div>
        <div class="section" style="width:160px">
          <label class="small muted">Lock Info</label>
          <button id="lockBtn" class="ok">Lock</button>
        </div>
      </div>

      <hr style="border:none;border-top:1px solid var(--border);margin:6px 0 8px 0" />

      <div class="section">
        <label class="small muted">Add Singer</label>
        <div class="row">
          <input id="singerName" placeholder="Singer name" />
          <input id="songTitle" placeholder="Song — Artist" />
          <button id="addBtn">Add</button>
        </div>
        <div class="help">Example: <span class="tag">Don’t Stop Believin’ — Journey</span></div>
      </div>
    </div>
  </section>

  <!-- RIGHT: QUICK ACTIONS / TOOLS -->
  <section class="panel">
    <h2>Tools</h2>
    <div class="content section">
      <div class="section">
        <div class="muted small">Current Settings</div>
        <div id="settingsSummary" class="help"></div>
      </div>
      <div class="section">
        <button id="clearQueue" class="danger">Clear Queue</button>
        <button id="clearAll">Clear All (incl. KJ/Venue/PIN)</button>
      </div>
      <div class="section">
        <div class="muted small">Auto-refresh hint</div>
        <div class="help">If TVs don’t live-update, we can add auto-refresh or real-time sync later.</div>
      </div>
    </div>
  </section>
</main>

<script>
  // --- State in localStorage (can swap to Firebase later) ---
  const $ = sel => document.querySelector(sel);
  const queueEl = $('#queue');
  const venueEl = $('#venue');
  const kjEl = $('#kj');
  const pinEl = $('#pin');
  const lockBtn = $('#lockBtn');
  const lockToggle = $('#lockToggle');
  const singerNameEl = $('#singerName');
  const songTitleEl = $('#songTitle');
  const addBtn = $('#addBtn');
  const clearQueueBtn = $('#clearQueue');
  const clearAllBtn = $('#clearAll');
  const settingsSummary = $('#settingsSummary');

  const LS = {
    get() {
      try { return JSON.parse(localStorage.getItem('eyek_host_state')||'{}'); }
      catch { return {}; }
    },
    set(data) {
      localStorage.setItem('eyek_host_state', JSON.stringify(data));
    }
  };

  function loadState() {
    const s = LS.get();
    venueEl.value = s.venue || '';
    kjEl.value = s.kj || '';
    pinEl.value = s.pin || '';
    lockToggle.checked = !!s.locked;
    setLockState(!!s.locked);
    renderQueue(s.queue || []);
    renderSummary();
  }

  function saveState(patch) {
    const s = Object.assign(LS.get(), patch);
    LS.set(s);
    renderSummary();
  }

  function setLockState(locked){
    [venueEl,kjEl,pinEl].forEach(el=>el.readOnly = locked);
    lockBtn.textContent = locked ? 'Unlock' : 'Lock';
    lockBtn.className = locked ? '' : 'ok';
  }

  function renderSummary(){
    const s = LS.get();
    const locked = s.locked ? 'Locked' : 'Editable';
    const venue = s.venue || '—';
    const kj = s.kj || '—';
    const pin = s.pin || '—';
    settingsSummary.innerHTML = `
      <div><strong>Status:</strong> ${locked}</div>
      <div><strong>Venue:</strong> ${venue}</div>
      <div><strong>KJ / PIN:</strong> ${kj} <span class="muted">(PIN: ${pin})</span></div>
    `;
    // Also ensure KJ field shows the PIN as part of its text if not already:
    if (pin && kjEl.value && !kjEl.value.includes(pin)) {
      // Append " — PIN 1234" once, non-destructive
      kjEl.value = kjEl.value.replace(/\s*—\s*PIN\s+\S+$/,'') + ` — PIN ${pin}`;
      saveState({ kj: kjEl.value });
    }
  }

  function renderQueue(q){
    queueEl.innerHTML = '';
    q.forEach((item, idx) => {
      const li = document.createElement('li');
      li.className = 'item';
      li.innerHTML = `
        <div class="grow">
          <div><strong>${escapeHtml(item.singer)}</strong></div>
          <div class="meta">${escapeHtml(item.song)}</div>
        </div>
        <div class="actions">
          <button data-act="up"    data-idx="${idx}">↑</button>
          <button data-act="down"  data-idx="${idx}">↓</button>
          <button data-act="del"   data-idx="${idx}">Remove</button>
        </div>
      `;
      queueEl.appendChild(li);
    });
  }

  function escapeHtml(s){ return (s||'').replace(/[&<>"']/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }

  // --- Events ---
  venueEl.addEventListener('input', () => saveState({ venue: venueEl.value }));
  kjEl.addEventListener('input', () => saveState({ kj: kjEl.value }));
  pinEl.addEventListener('input', () => saveState({ pin: pinEl.value }));

  lockBtn.addEventListener('click', () => {
    const locked = !LS.get().locked;
    setLockState(locked);
    saveState({ locked });
  });
  lockToggle.addEventListener('change', (e) => {
    const locked = e.target.checked;
    setLockState(locked);
    saveState({ locked });
  });

  addBtn.addEventListener('click', () => {
    const singer = singerNameEl.value.trim();
    const song = songTitleEl.value.trim();
    if(!singer || !song) return alert('Please enter both singer and song — artist.');
    const s = LS.get();
    const q = s.queue || [];
    q.push({ singer, song, at: Date.now() });
    saveState({ queue: q });
    renderQueue(q);
    singerNameEl.value = '';
    songTitleEl.value = '';
    singerNameEl.focus();
  });

  queueEl.addEventListener('click', (e) => {
    const btn = e.target.closest('button');
    if(!btn) return;
    const act = btn.dataset.act;
    const idx = +btn.dataset.idx;
    const s = LS.get();
    const q = s.queue || [];
    if(act === 'del'){ q.splice(idx,1); }
    if(act === 'up' && idx>0){ [q[idx-1],q[idx]] = [q[idx],q[idx-1]]; }
    if(act === 'down' && idx<q.length-1){ [q[idx+1],q[idx]] = [q[idx],q[idx+1]]; }
    saveState({ queue: q });
    renderQueue(q);
  });

  clearQueueBtn.addEventListener('click', () => {
    if(confirm('Clear the entire queue?')) {
      saveState({ queue: [] });
      renderQueue([]);
    }
  });

  clearAllBtn.addEventListener('click', () => {
    if(confirm('Clear ALL saved data (KJ, Venue, PIN, and Queue)?')) {
      localStorage.removeItem('eyek_host_state');
      loadState();
    }
  });

  // Init
  loadState();
</script>
</body>
</html>
