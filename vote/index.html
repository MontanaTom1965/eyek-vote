<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>EYEK • Vote</title>
<style>
  body{margin:0; font-family:system-ui, Arial, sans-serif; background:#0b0f14; color:#e8f0ff; display:flex; align-items:center; justify-content:center; min-height:100vh}
  .card{width:min(560px,95vw); background:#121821; border:1px solid #0f1520; border-radius:16px; padding:20px; box-shadow:0 20px 60px rgba(0,0,0,.35); text-align:center}
  h1{margin:0 0 6px}
  .muted{color:#a8b4c9}
  .btns{display:flex; gap:12px; margin-top:16px; flex-wrap:wrap; justify-content:center}
  button{border:none; padding:14px 18px; border-radius:12px; font-weight:800; cursor:pointer}
  .enc{background:#22c55e}
  .ano{background:#facc15; color:#141414}
  .may{background:#ef4444}
  .small{font-size:.9rem; margin-top:10px; color:#a8b4c9}
</style>
</head>
<body>
  <div class="card">
    <h1 id="who">Voting</h1>
    <div class="muted" id="venueKj">—</div>
    <div class="btns">
      <button class="enc" onclick="vote('encore')">Encore!</button>
      <button class="ano" onclick="vote('another')">Another Shot!</button>
      <button class="may" onclick="vote('maybe')">Maybe Next Time</button>
    </div>
    <div class="small" id="status">Waiting…</div>
  </div>

<script>
const API='/assets/api.php';
async function load(){
  const r = await fetch(API+'?cmd=get&ts='+Date.now(), {cache:'no-store'}); const j = await r.json();
  if (!j.ok) return;
  const st = j.state;
  document.getElementById('venueKj').textContent = (st.event.venue||'') + (st.event.kj?(' • '+st.event.kj):'');
  const cur = st.singers.find(s=>s.id===st.currentSingerId);
  document.getElementById('who').textContent = st.voting.open && cur ? ('Now Voting: '+cur.name) : 'Voting closed';
  document.getElementById('status').textContent = st.voting.open ? 'Voting is open — choose your vote.' : 'Please wait for the next singer.';
}
async function vote(choice){
  const f = new FormData(); f.append('cmd','vote'); f.append('choice', choice);
  const r = await fetch(API, { method:'POST', body:f }); const j = await r.json();
  if (j.ok) { document.getElementById('status').textContent='Vote submitted!'; }
  else      { document.getElementById('status').textContent='Voting closed.'; }
}
load();
setInterval(load, 2000);
</script>
</body>
</html>
