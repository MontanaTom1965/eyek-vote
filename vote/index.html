<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>EYEK • Vote</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{--bg:#0b0f1a;--card:#12192a;--txt:#eaf2ff;--muted:#a9b6d9;--green:#25d366;--yellow:#f6c945;--red:#ff5e6c}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--txt);font:600 18px/1.3 Inter,system-ui}
  .wrap{min-height:100svh;display:grid;place-items:center;padding:24px}
  .card{width:min(640px,92vw);background:linear-gradient(180deg,var(--card),#0f1526);border:1px solid #243459;border-radius:16px;padding:22px}
  .muted{color:var(--muted)}
  .big{font-size:30px}
  .grid{display:grid;gap:12px;margin-top:16px}
  .btn{padding:14px;border-radius:14px;border:0;color:#06130c;font-weight:800;cursor:pointer}
  .g{background:var(--green)} .y{background:var(--yellow)} .r{background:var(--red); color:#2a0b10}
  .small{font-size:12px;color:var(--muted);margin-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="muted">Now Voting For</div>
    <div id="singer" class="big">—</div>
    <div id="song" class="muted" style="margin-top:4px">—</div>

    <div class="grid">
      <button class="btn g" onclick="vote('encore')">Encore!</button>
      <button class="btn y" onclick="vote('another')">Another Shot!</button>
      <button class="btn r" onclick="vote('maybe')">Maybe Next Time</button>
    </div>
    <div id="msg" class="small"></div>
  </div>
</div>

<script>
const GET_URL = '/assets/get_state.php';
const POST_URL = '/assets/state.php';

let state=null;

async function load(){
  const r=await fetch(GET_URL,{cache:'no-store'});
  state=await r.json();
  document.getElementById('singer').textContent = state.current.name || "—";
  document.getElementById('song').textContent = state.current.songArtist || "—";
}
async function vote(kind){
  const msg=document.getElementById('msg');
  await load();
  if (!state.voting.open){ msg.textContent="Voting is closed."; return; }
  state.voting.counts[kind] = (state.voting.counts[kind]||0)+1;
  await fetch(POST_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(state)});
  msg.textContent="Thanks for voting!";
}
setInterval(load, 1500);
load();
</script>
</body>
</html>
