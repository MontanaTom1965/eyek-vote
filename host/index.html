<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Host Dashboard | Earn Your Encore Karaoke</title>
  <style>
    body { margin:0; font-family:system-ui,sans-serif; background:#0e0d2b; color:#fff; }
    .wrap { max-width:920px; margin:0 auto; padding:28px; }
    h1 { color:#ffd24a; }
    .panel { background:#1e1d3a; border-radius:12px; padding:16px; margin:16px 0; }
    label { font-weight:600; margin:10px 0 4px; display:block; }
    input { width:100%; padding:10px; border:0; border-radius:6px; background:#141335; color:#fff; }
    button { margin-top:10px; padding:10px 16px; border:0; border-radius:6px; background:#2a2954; color:#fff; cursor:pointer; }
    .linkbox { display:grid; grid-template-columns:1fr auto; gap:8px; align-items:center; margin:8px 0; }
    .qrrow { display:flex; gap:16px; align-items:center; flex-wrap:wrap; }
    .qr img { width:180px; height:180px; background:#fff; border-radius:8px; padding:8px; }
    .caption { line-height:1.35; font-size:14px; color:#dfe; }
    .small { font-size:13px; color:#ccc; margin-top:8px; }
    a { color:#9ee7ff; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Host Dashboard</h1>

    <div class="panel">
      <label for="singer">Singer Name</label>
      <input id="singer" type="text" placeholder="e.g., Ashley">
      <label for="sid">Session Code</label>
      <input id="sid" type="text" placeholder="e.g., ABC123">
      <button id="genSid">Generate Code</button>
    </div>

    <div class="panel">
      <label>Links</label>
      <div class="linkbox">
        <input id="screenLink" type="text" readonly>
        <button data-copy="#screenLink">Copy</button>
      </div>
      <div class="linkbox">
        <input id="voteLink" type="text" readonly>
        <button data-copy="#voteLink">Copy</button>
      </div>

      <div class="qrrow" style="margin-top:10px">
        <div class="qr"><img id="qr" alt="QR for vote link"></div>
        <div class="caption">
          <div id="previewTitleTop">You’re voting for this singer.</div>
          <div id="previewTitleBottom">Did they earn an Encore?</div>
          <div class="small" style="margin-top:10px">
            Open the <a id="openScreen" href="#" target="_blank" rel="noopener">Screen link</a> on your TV.
            The QR matches the Vote link.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const BASE = 'https://vote.earnyourencorekaraoke.com';
    const singerEl = document.getElementById('singer');
    const sidEl    = document.getElementById('sid');
    const screenEl = document.getElementById('screenLink');
    const voteEl   = document.getElementById('voteLink');
    const qrImg    = document.getElementById('qr');
    const openScreenA = document.getElementById('openScreen');
    const previewTop    = document.getElementById('previewTitleTop');
    const previewBottom = document.getElementById('previewTitleBottom');

    function makeSid() {
      return Math.random().toString(36).substring(2,8).toUpperCase();
    }

    function updateLinks() {
      const singerRaw = (singerEl.value || 'this singer').trim();
      const sidRaw    = (sidEl.value    || 'TEST').trim();

      const singer = encodeURIComponent(singerRaw);
      const sid    = encodeURIComponent(sidRaw);

      const screenURL = `${BASE}/screen/?sid=${sid}&singer=${singer}`;
      const voteURL   = `${BASE}/vote/?sid=${sid}&singer=${singer}`;

      screenEl.value = screenURL;
      voteEl.value   = voteURL;
      openScreenA.href = screenURL;

      // QR (vote link)
      qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(voteURL)}`;

      // Two-line caption next to QR
      previewTop.textContent = `You’re voting for ${singerRaw}.`;
      previewBottom.textContent = `Did they earn an Encore?`;
    }

    // Copy buttons
    document.addEventListener('click', e => {
      const btn = e.target.closest('button[data-copy]');
      if (!btn) return;
      const inp = document.querySelector(btn.dataset.copy);
      navigator.clipboard.writeText(inp.value || '');
      btn.textContent = 'Copied!';
      setTimeout(() => btn.textContent = 'Copy', 1000);
    });

    // Events
    document.getElementById('genSid').addEventListener('click', () => {
      sidEl.value = makeSid();
      updateLinks();
    });
    singerEl.addEventListener('input', updateLinks);
    sidEl.addEventListener('input', updateLinks);

    // Init
    sidEl.value = makeSid();
    updateLinks();
  </script>
</body>
</html>
