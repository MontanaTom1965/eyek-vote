<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Earn Your Encore Karaoke â€” Host</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-store" />
  <style>
    :root{
      --bg:#0b0b0f;
      --card:#141826;
      --accent:#7bc4ff;
      --text:#f7f8fc;
      --muted:#b9c0d0;
      --border:#26304a;
    }
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Helvetica Neue,Arial,Noto Sans;
      background:linear-gradient(180deg,#0b0b0f 0%,#0e1220 100%);
      color:var(--text);padding:20px;
    }
    h1{margin-top:0}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:20px;margin-bottom:20px}
    label{display:block;margin-bottom:6px;font-weight:600}
    input{padding:8px 10px;border-radius:8px;border:1px solid var(--border);width:100%;margin-bottom:10px}
    button{padding:10px 16px;border:none;border-radius:8px;background:var(--accent);color:#000;font-weight:600;cursor:pointer}
    ul{list-style:none;padding:0;margin:0}
    li{margin-bottom:6px;display:flex;justify-content:space-between;align-items:center}
    .danger{background:#f87171;color:#fff}
    .muted{color:var(--muted);font-size:14px;margin-top:8px}
  </style>
</head>
<body>
  <h1>Host Controls</h1>

  <div class="card">
    <h2>Create / Switch Event</h2>
    <label for="eventId">Event ID</label>
    <input id="eventId" placeholder="Enter event ID (e.g. bar-2025-09-05)" />
    <button onclick="setEvent()">Set Event</button>
    <div class="muted">Current event: <span id="currentEvent">none</span></div>
  </div>

  <div class="card">
    <h2>Add Singer</h2>
    <label for="singerName">Singer Name</label>
    <input id="singerName" placeholder="Enter singer name" />
    <button onclick="addSinger()">Add Singer</button>
    <ul id="singerList"></ul>
  </div>

  <div class="card">
    <h2>Votes</h2>
    <button class="danger" onclick="clearVotes()">Clear All Votes</button>
    <div class="muted">This wipes the votes for the current event.</div>
  </div>

  <script type="module">
    const FIREBASE_CONFIG = {
      apiKey: "AIzaSyDGbC08WxruYIDPhZSlDlU-7Kzq-7mHENk",
      authDomain: "eyek-vote.firebaseapp.com",
      projectId: "eyek-vote",
      storageBucket: "eyek-vote.firebasestorage.app",
      messagingSenderId: "954696683994",
      appId: "1:954696683994:web:21a84298a94648ff0230e3"
    };

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const app = initializeApp(FIREBASE_CONFIG);
    const db = getFirestore(app);

    let EVENT_ID = "default";
    const currentEventEl = document.getElementById("currentEvent");
    const singerListEl = document.getElementById("singerList");

    function setEvent() {
      const val = document.getElementById("eventId").value.trim();
      if (val) {
        EVENT_ID = val;
        currentEventEl.textContent = EVENT_ID;
        refreshSingers();
      }
    }
    window.setEvent = setEvent;

    async function addSinger() {
      const name = document.getElementById("singerName").value.trim();
      if (!name) return;
      await addDoc(collection(db, "events", EVENT_ID, "singers"), {
        name: name,
        ts: Date.now()
      });
      document.getElementById("singerName").value = "";
      refreshSingers();
    }
    window.addSinger = addSinger;

    async function refreshSingers() {
      singerListEl.innerHTML = "";
      const snap = await getDocs(collection(db, "events", EVENT_ID, "singers"));
      snap.forEach(d => {
        const li = document.createElement("li");
        li.textContent = d.data().name;
        singerListEl.appendChild(li);
      });
    }

    async function clearVotes() {
      const snap = await getDocs(collection(db, "events", EVENT_ID, "votes"));
      for (const d of snap.docs) {
        await deleteDoc(doc(db, "events", EVENT_ID, "votes", d.id));
      }
      alert("Votes cleared for event: " + EVENT_ID);
    }
    window.clearVotes = clearVotes;
  </script>
</body>
</html>
